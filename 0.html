<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes"/>
    <title>My First Three.js Project</title>
    <style>
        body{
            padding: 0px;
            margin: 0px;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div
style="position: absolute;
left:65%;
top:80%;
width: 3.7%;height: 6.7%;
visibility: hidden;
"id="quanpin"  onclick="IntoFullScreen()">
    <img src="tubiao1.png" width=100% height=100%/>
</div>

<div style="position: absolute;visibility: hidden;
left: 60%;
top:80%;
width: 3.7%;height: 6.7%;
"id="tuichu" onclick="ExitFullScreen()">
    <img src="tubiao2.png" width=100% height=100%/>
</div>

<div style="position: absolute;visibility: hidden;
left: 55%;
top: 80%;
width: 3.7%;height: 6.7%;"  id="large">
    <img src="tubiao3.png" width=100% height=100%/>
</div>

<div style="position: absolute;visibility: hidden;
left: 50%;
top: 80%;
width: 3.7%;height: 6.7%;;" id="smaller">
    <img src="tubiao4.png" width=100% height=100%/>
</div>

<div style="position: absolute;visibility: hidden;
left: 45%;
top: 80%;
width: 3.7%;height: 6.7%;" id="turnleft">
    <img src="tubiao5.png" width=100% height=100%/>
</div>

<div style="position: absolute;visibility: hidden;
left: 40%;
top: 80%;
width: 3.7%;height: 6.7%;" id="turnright">
    <img src="tubiao6.png" width=100% height=100%/>
</div>

<div style="position: absolute;visibility: hidden;
left: 35%;
top: 80%;
width: 3.7%;height: 6.7%;" id="upward">
    <img src="tubiao7.png" width=100% height=100%/>
</div>

<div style="position: absolute;visibility: hidden;
left: 30%;
top: 80%;
width: 3.7%;height: 6.7%;" id="downward">
    <img src="tubiao8.png" width=100% height=100%/>
</div>
<div
        style="position: absolute;
        width: 15%;
        height: 8%;visibility: hidden" id="load1">
    <img src="ncepu1.png" width=100% height=100%/>
    </div>
<div id="load2" style="position: absolute;top: 50%;left: 50%;color: coral">
    加载中...
</div>
<div id="device" style="position: absolute;top: 10%;left: 92%;
    width: 6%;height: 10%;visibility: hidden">
    <img src="device.png" width=100% height=100%/>
</div>
<script type="text/javascript" src="three.js"></script>
<script src="leapjs/leapjs-0.6.4/leap-0.6.4.js"></script>
<script src="leapjs/leapjs-0.6.4/examples/lib/leap-plugins-0.1.6.js"></script>
<script type="text/javascript">
    function IntoFullScreen() {
        var button=document.documentElement;
        if(button.requestFullscreen){
            button.requestFullscreen();
        }else if(button.mozRequestFullScreen){
            button.mozRequestFullScreen();
        }else if(button.webkitRequestFullScreen){
            button.webkitRequestFullScreen();
        }else if(button.msRequestFullScreen){
            button.mosRequestFullScreen();
        }
    }
    function ExitFullScreen() {
        if(document.exitFullscreen){
            document.exitFullscreen();
        }else if(document.mozCancelFullScreen){
            document.mozCancelFullScreen();
        }else if(document.webkitCancelFullScreen){
            document.webkitCancelFullScreen();
        }else if (document.msCancelFullScreen){
            document.msCancelFullScreen();
        }
    }
</script>
<script type="text/javascript">
    var camera,scene,renderer;
    var camera_time;
    var mesh;
    var lon = -90, lat = 0;
    var phi = 0, theta = 0;
    var target = new THREE.Vector3();
    var mouse=new THREE.Vector2();
    var mouse1=new THREE.Vector2();
    var raycaster=new THREE.Raycaster();
    var object=[];
    var large,s1,s2,s3,s4,s5,s6,smaller,turnleft,turnright,upward,downward,device,quanpin
    tuichu,load1,load2;
    var touchX,touchY,j=1;
    var sUserAgent = navigator.userAgent.toLowerCase();
    var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
    var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
    var bIsMidp = sUserAgent.match(/midp/i) == "midp";
    var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == "rv:1.2.3.4";
    var bIsUc = sUserAgent.match(/ucweb/i) == "ucweb";
    var bIsAndroid = sUserAgent.match(/android/i) == "android";
    var bIsCE = sUserAgent.match(/windows ce/i) == "windows ce";
    var bIsWM = sUserAgent.match(/windows mobile/i) == "windows mobile";
    var useAgent=navigator.userAgent;

    init();
    AddListener();
    animate();


        /*var colors = [0xff0000, 0x00ff00, 0x0000ff];
        var baseBoneRotation = (new THREE.Quaternion).setFromEuler(
            new THREE.Euler(Math.PI / 2, 0, 0)
        );

        Leap.loop({background: true}, {
            hand: function (hand) {

                hand.fingers.forEach(function (finger) {

                    // This is the meat of the example - Positioning `the cylinders on every frame:
                    finger.data('boneMeshes').forEach(function (mesh, i) {
                        var bone = finger.bones[i];

                        mesh.position.fromArray(bone.center());

                        mesh.setRotationFromMatrix(
                            (new THREE.Matrix4).fromArray(bone.matrix())
                        );

                        mesh.quaternion.multiply(baseBoneRotation);
                    });

                    finger.data('jointMeshes').forEach(function (mesh, i) {
                        var bone = finger.bones[i];

                        if (bone) {
                            mesh.position.fromArray(bone.prevJoint);
                        } else {
                            // special case for the finger tip joint sphere:
                            bone = finger.bones[i - 1];
                            mesh.position.fromArray(bone.nextJoint);
                        }

                    });

                });

                var armMesh = hand.data('armMesh');

                armMesh.position.fromArray(hand.arm.center());

                armMesh.setRotationFromMatrix(
                    (new THREE.Matrix4).fromArray(hand.arm.matrix())
                );

                armMesh.quaternion.multiply(baseBoneRotation);

                armMesh.scale.x = hand.arm.width / 2;
                armMesh.scale.z = hand.arm.width / 4;

                renderer.render(scene, camera);

            }
        })
        // these two LeapJS plugins, handHold and handEntry are available from leapjs-plugins, included above.
        // handHold provides hand.data
        // handEntry provides handFound/handLost events.
            .use('handHold')
            .use('handEntry')
            .on('handFound', function (hand) {

                hand.fingers.forEach(function (finger) {

                    var boneMeshes = [];
                    var jointMeshes = [];

                    finger.bones.forEach(function (bone) {

                        // create joints

                        // CylinderGeometry(radiusTop, radiusBottom, height, radiusSegments, heightSegments, openEnded)
                        var boneMesh = new THREE.Mesh(
                            new THREE.CylinderGeometry(5, 5, bone.length),
                            new THREE.MeshPhongMaterial()
                        );

                        boneMesh.material.color.setHex(0xffffff);
                        boneMesh.material.depthTest = false;
                        scene.add(boneMesh);
                        boneMeshes.push(boneMesh);
                    });

                    for (var i = 0; i < finger.bones.length + 1; i++) {

                        var jointMesh = new THREE.Mesh(
                            new THREE.SphereGeometry(8),
                            new THREE.MeshPhongMaterial()
                        );

                        jointMesh.material.color.setHex(0x0088ce);
                        jointMesh.material.depthTest = false;
                        scene.add(jointMesh);
                        jointMeshes.push(jointMesh);

                    }


                    finger.data('boneMeshes', boneMeshes);
                    finger.data('jointMeshes', jointMeshes);

                });

                if (hand.arm) { // 2.0.3+ have arm api,
                    // CylinderGeometry(radiusTop, radiusBottom, height, radiusSegments, heightSegments, openEnded)
                    var armMesh = new THREE.Mesh(
                        new THREE.CylinderGeometry(1, 1, hand.arm.length, 64),
                        new THREE.MeshPhongMaterial()
                    );

                    armMesh.material.color.setHex(0xffffff);
                    armMesh.material.depthTest = false;

                    scene.add(armMesh);

                    hand.data('armMesh', armMesh);

                }

            })
            .on('handLost', function (hand) {

                hand.fingers.forEach(function (finger) {

                    var boneMeshes = finger.data('boneMeshes');
                    var jointMeshes = finger.data('jointMeshes');

                    boneMeshes.forEach(function (mesh) {
                        scene.remove(mesh);
                    });

                    jointMeshes.forEach(function (mesh) {
                        scene.remove(mesh);
                    });

                    finger.data({
                        boneMeshes: null,
                        boneMeshes: null
                    });

                });

                var armMesh = hand.data('armMesh');
                scene.remove(armMesh);
                hand.data('armMesh', null);

                renderer.render(scene, camera);

            })
            .connect();*/



    function init() {
        scene = new THREE.Scene();//创建场景

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        ////设置透视投影相机参数，75为可视角，window.innerWidth / window.innerHeight为视口，0.1近裁面距离，100远裁面距离

        var geometry = new THREE.CubeGeometry(100, 100, 100);//创建几何图形-盒子缓存模型（x轴上面的宽度，y轴面上的高度，z轴上的深度）

        var textures = [];
        for (var i = 0; i < 6; i++) {
            textures[i] = new THREE.Texture();
        }

        large = document.getElementById('large');
        smaller = document.getElementById('smaller');
        turnleft = document.getElementById('turnleft');
        turnright = document.getElementById('turnright');
        upward = document.getElementById('upward');
        downward = document.getElementById('downward');
         quanpin = document.getElementById('quanpin');
         tuichu = document.getElementById('tuichu');
         load1 = document.getElementById('load1');
         load2 = document.getElementById('load2');
         device=document.getElementById('device');
        var img = new Image();
        img.src = '1.jpg';
        img.onload=function () {
            var canvas, context;
            for (var i = 0; i < 6; i++) {
                canvas = document.createElement('canvas');
                context = canvas.getContext('2d');
                canvas.width = img.height;
                canvas.height = img.height;
                context.drawImage(img, img.height * i, 0, img.height, img.height, 0, 0, img.height, img.height);
                textures[i].image = canvas;
                textures[i].needsUpdate = true;
            }
            if (!(bIsIpad || bIsIphoneOs || bIsMidp || bIsUc7 || bIsUc || bIsAndroid || bIsCE || bIsWM) ) {
                large.style.visibility = 'visible';
                smaller.style.visibility = 'visible';
                turnleft.style.visibility = 'visible';
                turnright.style.visibility = 'visible';
                upward.style.visibility = 'visible';
                downward.style.visibility = 'visible';
                load1.style.visibility = 'visible';
            }else{
                large.style.visibility = 'hidden';
                smaller.style.visibility = 'hidden';
                turnleft.style.visibility = 'hidden';
                turnright.style.visibility = 'hidden';
                upward.style.visibility = 'hidden';
                downward.style.visibility = 'hidden';
                load1.style.visibility = 'hidden';
                quanpin.style.width='6%';
                quanpin.style.height='10%';
                tuichu.style.width='6%';
                tuichu.style.height='10%';
                quanpin.style.left='45%';
                tuichu.style.left='55%';
            }
            device.style.visibility='visible';
            quanpin.style.visibility = 'visible';
            tuichu.style.visibility = 'visible';
            load2.style.visibility = 'hidden';

            InitText();
            object[0].position.set(-1.1, 0.15, -1.1);
            object[1].position.set(0.3,0.12,-1.2);
            for(var i=2;i<=40;i++){
                if (i==30){
                    object[i].position.set(-0.8,0.1,1);
                } else {
                    object[i].position.set(1000, 1000, 1000);
                }
            }
        };



        var material = [];
        for (var i = 0; i < 6; i++) {
            material[i] = new THREE.MeshBasicMaterial({map: textures[i]});
        }

        mesh = new THREE.Mesh(geometry, material);//构造实体，传入几何体和材质参数
        mesh.geometry.scale(1, 1, -1);//立方体图片向内翻转
        scene.add(mesh);//向场景中加入网格对象

        var directionalLight = new THREE.DirectionalLight( 0xffffff, 1 );
        directionalLight.position.set( 0, 0.5, 1 );
        scene.add(directionalLight);

        renderer = new THREE.WebGLRenderer({antialias:true,alpha:true});//创建渲染器
        renderer.setSize(window.innerWidth, window.innerHeight);//渲染器尺寸
        document.body.appendChild(renderer.domElement);
    }

 function AddListener(){
        document.addEventListener('mousedown',onDocumentMouseDown,false);
        document.addEventListener('wheel',onDocumentMouseWheel,false);

        document.addEventListener('touchstart',onDocumentTouchStart,false);
        document.addEventListener('touchmove',onDocumentTouchMove,false);

         if(window.DeviceMotionEvent) {
         window.addEventListener('devicemotion', onDeviceMotion, false);
         }else{alert('浏览器不支持重力遥感');}
        device.addEventListener('touchstart',ControlDeviceMotion,false);

         large.addEventListener('mousedown',DownEnlarge,true);
         smaller.addEventListener('mousedown',DownSmaller,true);
         turnleft.addEventListener('mousedown',TurnLeft,true);
         turnright.addEventListener('mousedown',TurnRight,true);
         upward.addEventListener('mousedown',UpWard,true);
        downward.addEventListener('mousedown',DownWard,true);

        Leap.loop({
            hand:function (hand) {
                /*var x,y;
                if (hand.screenPosition()[0]<0){
                    x=(hand.screenPosition()[0]/window.innerWidth);
                } else {
                    x=(hand.screenPosition()[0]/window.innerWidth);
                }
                if (hand.screenPosition()[1]<0){
                    y=(hand.screenPosition()[1]/window.innerHeight);
                } else {
                    y=(hand.screenPosition()[1]/window.innerHeight)+0.5;
                }
                console.log(x)
                LeapInter(x,y);*/

                if (hand.grabStrength==1){
                    camera.fov-=1;
                }else if (hand.grabStrength>0&&hand.grabStrength<1) {
                    camera.fov+=1;
                }else {
                    if (hand.direction[0]<0){
                        lon+=hand.screenPosition()[0]*hand.direction[0]*0.02;
                    } else {
                        lon += hand.screenPosition()[0] * hand.direction[0] * 0.002;
                    }
                    if (hand.direction[1]<0) {
                        lat += hand.screenPosition()[1] * hand.direction[1] * 0.05;
                    }else {
                        lat += hand.screenPosition()[1] * hand.direction[1] * 0.04;
                    }
                }
                if(camera.fov<5){
                    camera.fov=5;
                }
                if (camera.fov > 100) {
                    camera.fov = 100;
                }
                camera.updateProjectionMatrix();
            }
        }).use('screenPosition');


        window.addEventListener('resize', onWindowResize, false);
    }

    function ControlDeviceMotion() {
        event.preventDefault();
        j++;
        if(j%2==0) {
            if(window.DeviceMotionEvent) {
                window.removeEventListener('devicemotion', onDeviceMotion);
            }
        }else{
            if(window.DeviceMotionEvent) {
                window.addEventListener('devicemotion', onDeviceMotion, false);
            }else{alert('浏览器不支持重力遥感');}
        }
    }

    function LeapInter(x,y) {
        mouse1.x=x;
        mouse1.y=y;
        raycaster.setFromCamera(mouse1,camera);
        var intersect=raycaster.intersectObjects(object);
        if(intersect.length>0){
            switch (intersect[0].object.name) {
                case "scene1T2":
                    ChangeScene(2);
                    break;
                case "scene1T5":
                    ChangeScene(5);
                    break;
                case "scene2T1":
                    ChangeScene(1);
                    break;
                case "scene2T3":
                    ChangeScene(3);
                    break;
                case "scene3T2":
                    ChangeScene(2);
                    break;
                case "scene3T4":
                    ChangeScene(4);
                    break;
                case "scene4T3":
                    ChangeScene(3);
                    break;
                case "scene5T1":
                    ChangeScene(1);
                    break;
                case "scene4T6":
                    ChangeScene(6);
                    break;
                case "scene6T4":
                    ChangeScene(4);
                    break;
                case "scene6T7":
                    ChangeScene(7);
                    break;
                case "scene7T6":
                    ChangeScene(6);
                    break;
                case "scene5T8":
                    ChangeScene(8);
                    break;
                case "scene8T5":
                    ChangeScene(5);
                    break;
                case "scene8T7":
                    ChangeScene(7);
                    break;
                case "scene7T8":
                    ChangeScene(8);
                    break;
                case "scene8T9":
                    ChangeScene(9);
                    break;
                case "scene9T8":
                    ChangeScene(8);
                    break;
                case "scene9T10":
                    ChangeScene(10);
                    break;
                case "scene10T9":
                    ChangeScene(9);
                    break;
                case "scene10T11":
                    ChangeScene(11);
                    break;
                case "scene11T10":
                    ChangeScene(10);
                    break;
                case "scene11T12":
                    ChangeScene(12);
                    break;
                case "scene12T11":
                    ChangeScene(11);
                    break;
                case "scene12T7":
                    ChangeScene(7);
                    break;
                case "scene7T12":
                    ChangeScene(12);
                    break;
                case "scene5T13":
                    ChangeScene(13);
                    break;
                case "scene13T5":
                    ChangeScene(5);
                    break;
                case "scene13T9":
                    ChangeScene(9);
                    break;
                case "scene9T13":
                    ChangeScene(13);
                    break;
                case "scene1T14":
                    ChangeScene(14);
                    break;
                case "scene14T1":
                    ChangeScene(1);
                    break;
                case "scene14T3":
                    ChangeScene(3);
                    break;
                case "scene3T14":
                    ChangeScene(14);
                    break;
            }
        }
    }


    function onDocumentMouseDown(event) {
          mouse.x=(event.clientX/window.innerWidth)*2-1;
          mouse.y=-(event.clientY/window.innerHeight)*2+1;
          raycaster.setFromCamera(mouse,camera);
          var intersect=raycaster.intersectObjects(object);
          if(intersect.length>0){
              switch (intersect[0].object.name) {
                  case "scene1T2":
                      ChangeScene(2);
                      break;
                  case "scene1T5":
                      ChangeScene(5);
                      break;
                  case "scene2T1":
                      ChangeScene(1);
                      break;
                  case "scene2T3":
                      ChangeScene(3);
                      break;
                  case "scene3T2":
                      ChangeScene(2);
                      break;
                  case "scene3T4":
                      ChangeScene(4);
                      break;
                  case "scene4T3":
                      ChangeScene(3);
                      break;
                  case "scene5T1":
                      ChangeScene(1);
                      break;
                  case "scene4T6":
                      ChangeScene(6);
                      break;
                  case "scene6T4":
                      ChangeScene(4);
                      break;
                  case "scene6T7":
                      ChangeScene(7);
                      break;
                  case "scene7T6":
                      ChangeScene(6);
                      break;
                  case "scene5T8":
                      ChangeScene(8);
                      break;
                  case "scene8T5":
                      ChangeScene(5);
                      break;
                  case "scene8T7":
                      ChangeScene(7);
                      break;
                  case "scene7T8":
                      ChangeScene(8);
                      break;
                  case "scene8T9":
                      ChangeScene(9);
                      break;
                  case "scene9T8":
                      ChangeScene(8);
                      break;
                  case "scene9T10":
                      ChangeScene(10);
                      break;
                  case "scene10T9":
                      ChangeScene(9);
                      break;
                  case "scene10T11":
                      ChangeScene(11);
                      break;
                  case "scene11T10":
                      ChangeScene(10);
                      break;
                  case "scene11T12":
                      ChangeScene(12);
                      break;
                  case "scene12T11":
                      ChangeScene(11);
                      break;
                  case "scene12T7":
                      ChangeScene(7);
                      break;
                  case "scene7T12":
                      ChangeScene(12);
                      break;
                  case "scene5T13":
                      ChangeScene(13);
                      break;
                  case "scene13T5":
                      ChangeScene(5);
                      break;
                  case "scene13T9":
                      ChangeScene(9);
                      break;
                  case "scene9T13":
                      ChangeScene(13);
                      break;
                  case "scene1T14":
                      ChangeScene(14);
                      break;
                  case "scene14T1":
                      ChangeScene(1);
                      break;
                  case "scene14T3":
                      ChangeScene(3);
                      break;
                  case "scene3T14":
                      ChangeScene(14);
                      break;
              }
          }
          else {
              event.preventDefault();
              document.addEventListener('mousemove', onDocumentMouseMove, false);
              document.addEventListener('mouseup', onDocumentMouseUp, false);
          }
    }

    function onDocumentMouseMove(event) {
        event.preventDefault();
        var offsetX=event.movementX*0.15;
        var offsetY=event.movementY*0.15;
        lon=lon-offsetX;
        lat=lat+offsetY;
    }

    function onDocumentMouseUp(event) {
        event.preventDefault();
        document.removeEventListener('mousemove',onDocumentMouseMove);
        document.removeEventListener('mouseup',onDocumentMouseUp);
    }

    function onDocumentMouseWheel(event){
        var speed;
        if(useAgent.indexOf("Firefox")>-1){
            speed=0.8;
        }
        else{
            speed=0.04;
        }
        var fov=camera.fov+event.deltaY*speed;
          camera.fov=fov;
          if(camera.fov<5){
              camera.fov=5;
          }
          if(camera.fov>100){
              camera.fov=100;
          }
        camera.updateProjectionMatrix();
    }

    function onDocumentTouchStart(event) {
        event.preventDefault();
        var touch=event.touches[0];
         touchX=touch.screenX;
         touchY=touch.screenY;
    }

    function onDocumentTouchMove(event) {
        event.preventDefault();
        var touch=event.touches[0];
        lon=lon-(touch.screenX-touchX)*0.1;
        lat=lat+(touch.screenY-touchY)*0.1;
        touchX=touch.screenX;
        touchY=touch.screenY;
    }

    function onDeviceMotion(event) {//重力遥感
        var a=event.accelerationIncludingGravity;
        var x=a.x;
        var z=a.z;
        lon=lon+x*0.3;
        lat=lat-z*0.3;
    }
    
    function ChangeScene(x) {
        camera_time=0;
        var texture = [];
        for (var i = 0; i < 6; i++) {
            texture[i] = new THREE.Texture();
        }
        large = document.getElementById('large');
        smaller = document.getElementById('smaller');
        turnleft = document.getElementById('turnleft');
        turnright = document.getElementById('turnright');
        upward = document.getElementById('upward');
        downward = document.getElementById('downward');
        quanpin.style.visibility = 'hidden';
        tuichu.style.visibility = 'hidden';
        large.style.visibility = 'hidden';
        smaller.style.visibility = 'hidden';
        turnleft.style.visibility = 'hidden';
        turnright.style.visibility = 'hidden';
        upward.style.visibility = 'hidden';
        downward.style.visibility = 'hidden';
        load1.style.visibility = 'hidden';
        load2.style.visibility = 'visible';
        device.style.visibility = 'hidden';
        var img = new Image();
        img.src = x + '.jpg';
        img.onload = function () {
            var canvas, context;
            for (var i = 0; i < 6; i++) {
                canvas = document.createElement('canvas');
                context = canvas.getContext('2d');
                canvas.width = img.height;
                canvas.height = img.height;
                context.drawImage(img, img.height * i, 0, img.height, img.height, 0, 0, img.height, img.height);
                texture[i].image = canvas;
                texture[i].needsUpdate = true;
            }
            if (!(bIsIpad || bIsIphoneOs || bIsMidp || bIsUc7 || bIsUc || bIsAndroid || bIsCE || bIsWM) ) {
                large.style.visibility = 'visible';
                smaller.style.visibility = 'visible';
                turnleft.style.visibility = 'visible';
                turnright.style.visibility = 'visible';
                upward.style.visibility = 'visible';
                downward.style.visibility = 'visible';
                load1.style.visibility = 'visible';
            }else{
                large.style.visibility = 'hidden';
                smaller.style.visibility = 'hidden';
                turnleft.style.visibility = 'hidden';
                turnright.style.visibility = 'hidden';
                upward.style.visibility = 'hidden';
                downward.style.visibility = 'hidden';
                load1.style.visibility = 'hidden';
                quanpin.style.width='6%';
                quanpin.style.height='10%';
                tuichu.style.width='6%';
                tuichu.style.height='10%';
                quanpin.style.left='45%';
                tuichu.style.left='55%';
            }
            device.style.visibility='visible';
            quanpin.style.visibility = 'visible';
            tuichu.style.visibility = 'visible';
            load2.style.visibility = 'hidden';
        }
        var material = mesh.material;
        for (var i = 0; i < 6; i++) {
            material[i] = new THREE.MeshBasicMaterial({map: texture[i]});
        }
        material.map.needsUpdate = true;
        switch (x) {
            case 1:
                object[0].position.set(-1.1, 0.15, -1.1);
                object[1].position.set(0.3,0.12,-1.2);
                for (var i = 2; i <= 40; i++) {
                    if (i==30){
                        object[i].position.set(-0.8,0.1,1);
                    } else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 2:
                for (var i = 0; i <= 40; i++) {
                    if (i == 2) {
                        object[i].position.set(-0.3, 0.1, 1.0);
                    } else if (i == 3) {
                        object[i].position.set(1.2,0.1, 0.1);
                    } else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 3:
                for (var i = 0; i <= 40; i++) {
                    if (i == 4) {
                        object[i].position.set(-1.5, 0.05, 1.1);
                    } else if (i == 5) {
                        object[i].position.set(0.08, 0.1, -1.06);
                    }else if (i==33){
                        object[i].position.set(-1.9,0.05,0.6);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 4:
                for (var i = 0; i <= 40; i++) {
                    if (i == 6) {
                        object[i].position.set(-0.22, 0.1, 1.1);
                    } else if (i == 8) {
                        object[i].position.set(0.1, 0.1, -1.5);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 5:
                for (var i = 0; i <= 40; i++) {
                    if (i == 7) {
                        object[i].position.set(-0.3, 0.1, 1);
                    }else if (i==12){
                        object[i].position.set(0.2,0.1,-1.5);
                    }else if (i==26){
                        object[i].position.set(0.6,0.15,-1.5);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 6:
                for (var i = 0; i <=40; i++) {
                    if (i == 9) {
                        object[i].position.set(0.1, 0.1, 1.1);
                    } else if (i == 10) {
                        object[i].position.set(0.17, 0.1, -1.1);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 7:
                for (var i = 0; i <= 40; i++) {
                    if (i == 11) {
                        object[i].position.set(0.1, 0.1, -1.5);
                    }else if (i==15){
                        object[i].position.set(-1.5,0.15,1);
                    }else if (i==25){
                        object[i].position.set(1.0,0.1,-1.5);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 8:
                for (var i = 0; i <= 40; i++){
                    if (i==13){
                        object[i].position.set(0.23,0.1,1);
                    }else if (i==14){
                        object[i].position.set(0,0.1,-1)
                    }else if (i==16){
                        object[i].position.set(1.5,0.1,-0.2);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 9:
                for (var i=0;i<=40;i++){
                    if (i==17){
                      object[i].position.set(-1.2,0.1,0.5);
                    }else if (i==18){
                        object[i].position.set(-0.45,0.15,-1.0);
                    }else if (i==29){
                        object[i].position.set(0.1,0.15,1.0);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 10:
                for (var i=0;i<=40;i++){
                    if (i==19){
                        object[i].position.set(0.1,0.1,1);
                    }else if (i==20){
                        object[i].position.set(-0.05,0.1,-1.0);
                    }
                    else
                    {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 11:
                for (var i=0;i<=40;i++){
                    if (i==21){
                        object[i].position.set(0,0.1,1)
                    }else if (i==22){
                        object[i].position.set(-1.6,0.2,-0.5);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 12:
                for (var i=0;i<=40;i++){
                    if (i==23){
                        object[i].position.set(0.22,0.1,-1.4);
                    }else if (i==24){
                        object[i].position.set(-0.25,0.07,1);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 13:
                for(var i=0;i<=40;i++){
                    if (i==27){
                        object[i].position.set(0.25,0.1,1)
                    }else if (i==28){
                        object[i].position.set(0,0.1,-1)
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
            case 14:
                for (var i=0;i<=40;i++){
                    if (i==31){
                        object[i].position.set(-0.8,0.1,1)
                    }else if (i==32){
                        object[i].position.set(1.5,0.1,1);
                    }
                    else {
                        object[i].position.set(1000, 1000, 1000);
                    }
                }
                break;
        }
    }

    function InitText() {
        object[0] = WriteText();
        object[0].name = "scene1T2";//主场景指向操场箭头
        scene.add(object[0]);
        object[1]=WriteText();
        object[1].name="scene1T5";//主场景指向六舍箭头
        scene.add(object[1]);
        object[2] = WriteText();
        object[2].name = "scene2T1";//操场指向主场面箭头
        scene.add(object[2]);
        object[3] = WriteText();
        object[3].name = "scene2T3";//操场指向小卖部箭头
        scene.add(object[3]);
        object[4]=WriteText();
        object[4].name="scene3T2";//小卖部指向操场箭头
        scene.add(object[4]);
        object[5]=WriteText();
        object[5].name="scene3T4";//小卖部指向十舍道路箭头
        scene.add(object[5]);
        object[6]=WriteText();
        object[6].name="scene4T3";//十舍道路指向小卖部箭头
        scene.add(object[6]);
        object[7]=WriteText();
        object[7].name="scene5T1";//六舍指向主场景箭头
        scene.add(object[7]);
        object[8]=WriteText();
        object[8].name="scene4T6";//十舍道路指向日新园箭头
        scene.add(object[8]);
        object[9]=WriteText();
        object[9].name="scene6T4";//日新园指向十舍道路箭头
        scene.add(object[9]);
        object[10]=WriteText();
        object[10].name="scene6T7";//日新园指向小操场箭头
        scene.add(object[10]);
        object[11]=WriteText();
        object[11].name="scene7T6";//小操场指向日新园箭头
        scene.add(object[11]);
        object[12]=WriteText();
        object[12].name="scene5T8";//6舍指向教8箭头
        scene.add(object[12]);
        object[13]=WriteText();
        object[13].name="scene8T5";//教8指向6舍箭头
        scene.add(object[13]);
        object[14]=WriteText();
        object[14].name="scene8T7";//教8指向小足球场箭头
        scene.add(object[14]);
        object[15]=WriteText();
        object[15].name="scene7T8";//小足球场指向教8箭头
        scene.add(object[15]);
        object[16]=WriteText();
        object[16].name="scene8T9";//教8指向三餐箭头
        scene.add(object[16]);
        object[17]=WriteText();
        object[17].name="scene9T8";//三餐指向教8箭头
        scene.add(object[17]);
        object[18]=WriteText();
        object[18].name="scene9T10";//三餐指向19舍箭头
        scene.add(object[18]);
        object[19]=WriteText();
        object[19].name="scene10T9";//19舍指向三餐箭头
        scene.add(object[19]);
        object[20]=WriteText();
        object[20].name="scene10T11";//19舍指向北门箭头
        scene.add(object[20]);
        object[21]=WriteText();
        object[21].name="scene11T10";//北门指向19舍箭头
        scene.add(object[21]);
        object[22]=WriteText();
        object[22].name="scene11T12";//北门指向14舍箭头
        scene.add(object[22]);
        object[23]=WriteText();
        object[23].name="scene12T11";//14舍指向北门箭头
        scene.add(object[23]);
        object[24]=WriteText();
        object[24].name="scene12T7";//14舍指向小足球场箭头
        scene.add(object[24]);
        object[25]=WriteText();
        object[25].name="scene7T12";//小足球场指向14舍箭头
        scene.add(object[25]);
        object[26]=WriteText();
        object[26].name="scene5T13";//6舍指向近邻宝箭头
        scene.add(object[26]);
        object[27]=WriteText();
        object[27].name="scene13T5";//近邻宝指向6舍箭头
        scene.add(object[27]);
        object[28]=WriteText();
        object[28].name="scene13T9";//近邻宝指向三餐箭头
        scene.add(object[28]);
        object[29]=WriteText();
        object[29].name="scene9T13";//三餐指向近邻宝箭头
        scene.add(object[29]);
        object[30]=WriteText();
        object[30].name="scene1T14";//主场景指向教十二箭头
        scene.add(object[30]);
        object[31]=WriteText();
        object[31].name="scene14T1";//教十二指向主场景箭头
        scene.add(object[31]);
        object[32]=WriteText();
        object[32].name="scene14T3";//教十二指向小卖部箭头
        scene.add(object[32]);
        object[33]=WriteText();
        object[33].name="scene3T14";//小卖部指向教十二箭头
        scene.add(object[33]);
    }

    function DrawArrow() {
        var canvas=document.createElement('canvas');
        var ctx=canvas.getContext('2d');
        canvas.width=50;
        canvas.height=50;
        ctx.beginPath();
        ctx.arc(25,40,5,1.8*Math.PI,1.3*Math.PI);
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(25,40,10,1.8*Math.PI,1.25*Math.PI);
        ctx.fillStyle='#98FB98';
        ctx.fill();
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(20,5);
        ctx.lineTo(30,5);
        ctx.lineTo(30,25);
        ctx.lineTo(40,25);
        ctx.lineTo(25,40);
        ctx.lineTo(10,25);
        ctx.lineTo(20,25);
        ctx.lineTo(20,5);
        ctx.fillStyle="#98FB98";
        ctx.fill();
        ctx.stroke();
        return canvas;
    }

    function WriteText() {
        var canvas;
        canvas=DrawArrow();
        var texture=new THREE.Texture(canvas);
        texture.needsUpdate=true;
        var material=new THREE.SpriteMaterial({map:texture});
        var mesh1=new THREE.Sprite(material);
        mesh1.scale.set(0.15,0.15,0.15);
        return mesh1;
    }

    function DownEnlarge() {
        event.preventDefault();
        var time1=1;
        s1= window.setInterval(function () {
             var speed=0.01;
             var fov=camera.fov-speed*(time1++);
             camera.fov=fov;
             if(camera.fov<5){
                 camera.fov=5;
             }
             camera.updateProjectionMatrix();
         },0);
         large.addEventListener('mouseup',Up,true);
    }

    function Up() {
        event.preventDefault();
        clearInterval(s1);
        event.preventDefault();
        large.removeEventListener('mousedown',DownEnlarge);
        large.removeEventListener('mouseup',Up);
    }

    function DownSmaller() {
        event.preventDefault();
        var time1 = 1;
        s2 = window.setInterval(function () {
            var speed = 0.01;
            var fov = camera.fov + speed * (time1++);
            camera.fov = fov;
            if (camera.fov > 100) {
                camera.fov = 100;
            }
            camera.updateProjectionMatrix();
        }, 0);
        smaller.addEventListener('mouseup', Up1, true);
    }

    function Up1() {
        event.preventDefault();
        clearInterval(s2);
        event.preventDefault();
        smaller.removeEventListener('mousedown',DownSmaller);
        smaller.removeEventListener('mouseup',Up1);
    }

    function TurnLeft() {
        event.preventDefault();
        s3=window.setInterval(function () {
            lon=lon-3;
        },0);
        turnleft.addEventListener('mouseup',Up2,true);
    }

    function Up2() {
        event.preventDefault();
        clearInterval(s3);
        event.preventDefault();
        turnleft.removeEventListener('mousedown',TurnLeft);
        turnleft.removeEventListener('mouseup',Up2);
    }

    function TurnRight() {
        event.preventDefault();
        s4=window.setInterval(function () {
            lon=lon+3;
        },0);
        turnright.addEventListener('mouseup',Up3,true);
    }

    function Up3() {
        event.preventDefault();
        clearInterval(s4);
        event.preventDefault();
        turnright.removeEventListener('mousedown',TurnRight);
        turnright.removeEventListener('mouseup',Up3);
    }

    function UpWard() {
        event.preventDefault();
        s5=window.setInterval(function () {
            lat=lat+3;
        },0);
        upward.addEventListener('mouseup',Up4,true);
    }

    function Up4() {
        event.preventDefault();
        clearInterval(s5);
        event.preventDefault();
        upward.removeEventListener('mousedown',UpWard);
        upward.removeEventListener('mouseup',Up4);;
    }

    function DownWard() {
        event.preventDefault();
        s6=window.setInterval(function () {
            lat=lat-3;
        },0);
        downward.addEventListener('mouseup',Up5,true);
    }

    function Up5() {
        event.preventDefault();
        clearInterval(s6);
        event.preventDefault();
        downward.removeEventListener('mousedown',DownWard);
        downward.removeEventListener('mouseup',Up5);
    }
    
    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
            requestAnimationFrame(animate);//动画
            if (lat > 88) {
                lat = 88;
            }
            if (lat < -88) {
                lat = -88;
            }
            phi = (90 - lat) * (Math.PI / 180);
            theta = lon * (Math.PI / 180);
            target.x = Math.cos(theta) * Math.sin(phi);
            target.y = Math.cos(phi);
            target.z = Math.sin(phi) * Math.sin(theta);
            camera.lookAt(target);
            renderer.render(scene, camera);//结合场景和相机进行渲染
    }
</script>
</body>
</html>